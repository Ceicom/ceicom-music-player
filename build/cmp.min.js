"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function _createClass(e,t,a){return t&&_defineProperties(e.prototype,t),a&&_defineProperties(e,a),e}!function(){var e=function(){function e(t){_classCallCheck(this,e),this._musics=t,this._fakePlayer=$(".cmp-player"),this._$playBtn=this._fakePlayer.find(".play-btn"),this._$progressBar=this._fakePlayer.find(".progress-bar"),this._$nextBtn=this._fakePlayer.find(".next-btn"),this._$time=this._fakePlayer.find(".time"),this._$volumeWrapper=this._fakePlayer.find(".volume-wrapper"),this._$volumeInput=this._fakePlayer.find(".volume-input"),this._currentMusic=0,this._currentVolume=.1,this.init()}return _createClass(e,[{key:"_createPlayer",value:function(){var e=this._musics[this._currentMusic];if(this._player)return this._$nextBtn.toggleClass("disabled","comercial"===e.typemedia||"vinheta"===e.typemedia),this._player.setAttribute("src",e.mp3),this._player.load(),void this._player.play();var t=document.createElement("audio");t.src=e.mp3,t.preload="none",t.volume=this._currentVolume,this._player=t}},{key:"_musicEnded",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._fakePlayer.removeClass("playing"),this._resetProgressBar(),this._currentMusic++,this._currentMusic>=this._musics.length&&(this._currentMusic=0),$(document).trigger("cmp-media-end",[this._currentMusic,e]),this._makePlayer()}},{key:"_initPlayerListeners",value:function(){var e=this;$(this._player).on("timeupdate",function(){e._updateTime(e._player.currentTime,e._player.duration),e._updateProgressBar(e._player.currentTime,e._player.duration)}),$(this._player).on("play pause",function(){return e._isPlaying()?e._fakePlayer.addClass("playing"):e._fakePlayer.removeClass("playing")}),$(this._player).on("ended",function(){return e._musicEnded()}),$(this._player).on("loadstart",function(){var t=e._player.play();null!==t&&t.catch(function(){return e._makePlayer()})}),$(this._player).on("error",function(){navigator.onLine&&e._musicEnded(!0)})}},{key:"_makePlayer",value:function(){this._musics.length?($(this._player).off("timeupdate"),$(this._player).off("play pause"),$(this._player).off("ended"),$(this._player).off("canplaythrough"),this._createPlayer(),this._initPlayerListeners()):$(this._fakePlayer).html('<span class="error-msg">Nenhuma m√∫sica detectada na lista atual.</span>')}},{key:"_initFakePlayerActions",value:function(){var e=this;this._$playBtn.on("click",function(){return e._isPlaying()?e._player.pause():e._player.play()}),this._$nextBtn.on("click",function(){e._$nextBtn.hasClass("disabled")||e._musicEnded()}),this._$volumeWrapper.on("click",function(t){$(t.target).hasClass("volume-wrapper")&&e._$volumeWrapper.toggleClass("active")}),this._$volumeInput.on("input",function(){return e.setVolume(e._$volumeInput.val()/10)})}},{key:"_isPlaying",value:function(){return!this._player.paused}},{key:"_resetProgressBar",value:function(){this._$progressBar.css("transform","scaleX(0)")}},{key:"_updateProgressBar",value:function(e,t){this._$progressBar.css("transform","scaleX(".concat(Math.floor(e)/Math.floor(t),")"))}},{key:"_updateTime",value:function(e,t){var a=function(e){return e<10?"0"+e:e},r=function(e){var t=parseInt(e%60),r=parseInt(e/60%60);return a(r)+":"+a(t)};this._$time.text(r(e)+" / "+r(t))}},{key:"init",value:function(){var e=this;$(window).on("offline",function(){return e._fakePlayer.addClass("offline")}),$(window).on("online",function(){e._fakePlayer.removeClass("offline");var t=e._player.play();null!==t&&t.catch(function(){return e._makePlayer()})}),this._initFakePlayerActions(),this._makePlayer()}},{key:"getVolume",value:function(){return this._currentVolume}},{key:"setVolume",value:function(e){this._currentVolume=e,this._player.volume=this._currentVolume,this._$volumeInput.val(10*e)}}]),e}();"undefined"!=typeof exports?exports.CeicomMusicPlayer=e:window.CeicomMusicPlayer=e}("undefined"!=typeof global&&global);